<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Leadership Prism | From Here</title>
  <style>
    :root{ --radius: 22px; }

    html, body{ margin:0; height:100%; background: transparent; }
    body{ display:flex; align-items:center; justify-content:center; }

    .stage{
      position:relative; width:100%; max-width:1100px; height:620px;
      border-radius: var(--radius); overflow:hidden; background: transparent;
    }

    .light{
      position:absolute; inset:-25%; pointer-events:none;
      background:
        radial-gradient(820px 520px at 78% 55%, rgba(255,255,255,0.18), rgba(255,255,255,0) 60%),
        radial-gradient(620px 440px at 72% 62%, rgba(120,220,255,0.20), rgba(120,220,255,0) 62%),
        radial-gradient(620px 440px at 80% 70%, rgba(255,190,90,0.18), rgba(255,190,90,0) 64%),
        radial-gradient(620px 440px at 68% 72%, rgba(255,120,170,0.16), rgba(255,120,170,0) 66%);
      mix-blend-mode: screen;
      filter: blur(14px) saturate(1.25);
      opacity: 0.95;
    }

    .prism-wrap{
      position:absolute; inset:0;
      display:flex; align-items:center; justify-content:center;
      z-index: 2;
      touch-action: none;
    }

    .scene{
      width: 520px; height: 520px;
      max-width: 76vw; max-height: 76vw;
      perspective: 900px; perspective-origin: 55% 45%;
    }

    .prism{
      width: 260px; height: 340px;
      position: relative;
      transform-style: preserve-3d;
      transform: rotateX(-12deg) rotateY(22deg);
      cursor: grab;
      will-change: transform;
      outline: none;
    }
    .prism:active{ cursor: grabbing; }

    .face{
      position:absolute; width: 260px; height: 340px; left:0; top:0;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.22);
      box-shadow: 0 10px 35px rgba(0,0,0,0.25);
      background: rgba(255,255,255,0.08);
      backdrop-filter: blur(3px);
      overflow:hidden;
      display:flex; align-items:flex-end; justify-content:flex-start;
      padding: 16px; box-sizing:border-box;
      user-select:none;
      transition: border-color 120ms ease, box-shadow 120ms ease, transform 120ms ease;
      cursor: pointer;
    }

    .face::before{
      content:"";
      position:absolute; inset:-30%;
      background:
        radial-gradient(380px 240px at 25% 25%, rgba(255,255,255,0.22), rgba(255,255,255,0) 58%),
        radial-gradient(520px 380px at 70% 70%, rgba(0,0,0,0.40), rgba(0,0,0,0) 60%);
      opacity: 0.7;
      transform: rotate(10deg);
      pointer-events:none;
    }

    .face:hover{
      border-color: rgba(255,255,255,0.40);
      box-shadow: 0 12px 50px rgba(0,0,0,0.32);
    }

    .label{
      position:relative;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      font-size: 14px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.86);
      text-shadow: 0 2px 10px rgba(0,0,0,0.35);
    }

    .face.active{
      border-color: rgba(255,255,255,0.52);
      box-shadow: 0 12px 55px rgba(0,0,0,0.34);
    }

    /* Soft guidance nudge */
    @keyframes nudgeGlow {
      0%   { box-shadow: 0 10px 35px rgba(0,0,0,0.25), 0 0 0 rgba(255,255,255,0.0); }
      50%  { box-shadow: 0 14px 55px rgba(0,0,0,0.32), 0 0 22px rgba(255,255,255,0.18); }
      100% { box-shadow: 0 10px 35px rgba(0,0,0,0.25), 0 0 0 rgba(255,255,255,0.0); }
    }
    .nudge .face{ animation: nudgeGlow 1400ms ease-in-out 3; }

    .f0{ transform: rotateY(0deg)   translateZ(180px); background: linear-gradient(135deg, rgba(120,220,255,0.55), rgba(255,255,255,0.06)); }
    .f1{ transform: rotateY(72deg)  translateZ(180px); background: linear-gradient(135deg, rgba(70,205,170,0.55), rgba(255,255,255,0.06)); }
    .f2{ transform: rotateY(144deg) translateZ(180px); background: linear-gradient(135deg, rgba(255,210,120,0.55), rgba(255,255,255,0.06)); }
    .f3{ transform: rotateY(216deg) translateZ(180px); background: linear-gradient(135deg, rgba(255,160,110,0.55), rgba(255,255,255,0.06)); }
    .f4{ transform: rotateY(288deg) translateZ(180px); background: linear-gradient(135deg, rgba(255,120,170,0.55), rgba(255,255,255,0.06)); }

    .core{
      position:absolute; width: 120px; height: 120px;
      border-radius: 28px;
      left: 50%; top: 50%;
      transform-style: preserve-3d;
      transform: translate(-50%, -50%) translateZ(0px);
      background: rgba(255,255,255,0.10);
      border: 1px solid rgba(255,255,255,0.18);
      box-shadow: 0 10px 35px rgba(0,0,0,0.25);
      backdrop-filter: blur(6px);
      display:flex; align-items:center; justify-content:center;
      pointer-events: none;
    }
    .core span{
      font-family: Georgia, "Times New Roman", Times, serif;
      font-size: 16px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.82);
    }

    .hint{
      position:absolute; right:18px; bottom:16px;
      padding:8px 10px;
      border-radius:999px;
      background:rgba(10,12,16,0.40);
      border:1px solid rgba(255,255,255,0.14);
      color:rgba(255,255,255,0.75);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      font-size:12px;
      backdrop-filter: blur(8px);
      z-index: 5;
      opacity: 1;
      transition: opacity 600ms ease;
      user-select:none;
      pointer-events:none;
    }
    .hint.fade{ opacity: 0; }

    .overlay{
      position:absolute; inset:0;
      background: rgba(0,0,0,0.18);
      backdrop-filter: blur(4px);
      opacity: 0;
      pointer-events: none;
      transition: opacity 220ms ease;
      z-index: 7;
    }
    .overlay.open{ opacity: 1; pointer-events: auto; }

    .drawer{
      position:absolute; top: 16px; right: 16px;
      width: min(520px, calc(100% - 32px));
      height: calc(100% - 32px);
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(10,12,16,0.55);
      backdrop-filter: blur(12px);
      box-shadow: 0 20px 70px rgba(0,0,0,0.35);
      transform: translateX(18px);
      opacity: 0;
      transition: transform 220ms ease, opacity 220ms ease;
      overflow: hidden;
      display:flex; flex-direction: column;
    }
    .overlay.open .drawer{ transform: translateX(0); opacity: 1; }

    .drawer-head{
      padding: 16px 16px 12px 16px;
      border-bottom: 1px solid rgba(255,255,255,0.12);
      display:flex; align-items:flex-start; justify-content:space-between;
      gap: 10px;
    }
    .drawer-kicker{
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      font-size:12px; letter-spacing:0.14em; text-transform:uppercase;
      color: rgba(255,255,255,0.65);
      margin:0 0 6px 0;
    }
    .drawer-title{
      font-family: Georgia, "Times New Roman", Times, serif;
      font-size: 26px; line-height: 1.05;
      margin:0;
      color: rgba(255,255,255,0.94);
    }
    .close{
      appearance:none;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.06);
      color: rgba(255,255,255,0.85);
      border-radius: 999px;
      width: 34px; height: 34px;
      display:flex; align-items:center; justify-content:center;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      font-size: 16px;
      cursor: pointer;
      flex: 0 0 auto;
      line-height: 1;
    }
    .drawer-body{ padding: 14px 16px 16px 16px; overflow:auto; }

    .section{ margin: 12px 0 16px 0; }
    .section h4{
      margin: 0 0 8px 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      font-size: 12px;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.70);
    }
    .section p{
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      font-size: 14px;
      line-height: 1.6;
      color: rgba(255,255,255,0.80);
    }

    .pillset{ display:flex; flex-wrap:wrap; gap: 8px; margin-top: 10px; }
    .pill{
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(255,255,255,0.06);
      border-radius: 999px;
      padding: 8px 10px;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      font-size: 12px;
      color: rgba(255,255,255,0.84);
      white-space: nowrap;
    }

    ul.clean{
      list-style: none; padding: 0; margin: 10px 0 0 0;
      display:flex; flex-direction: column; gap: 10px;
    }
    ul.clean li{
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.05);
      border-radius: 14px;
      padding: 10px 12px;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: rgba(255,255,255,0.84);
      font-size: 13px;
      line-height: 1.45;
    }
    ul.clean li b{ color: rgba(255,255,255,0.92); font-weight: 600; }

    @media (max-width: 720px){
      .stage{ height: 740px; }
      .scene{ width: 86vw; height: 86vw; }
      .drawer{ top: 12px; right: 12px; width: calc(100% - 24px); height: calc(100% - 24px); }
    }
  </style>
</head>

<body>
  <div class="stage">
    <div class="light"></div>

    <div class="prism-wrap nudge" id="dragArea">
      <div class="scene">
        <div class="prism" id="prism" tabindex="0" role="img" aria-label="Interactive prism. Drag to rotate. Click a face.">
          <div class="face f0" data-key="Knowledge" aria-label="Open Knowledge details"><div class="label">Knowledge</div></div>
          <div class="face f1" data-key="Skills" aria-label="Open Skills details"><div class="label">Skills</div></div>
          <div class="face f2" data-key="Attributes" aria-label="Open Attributes details"><div class="label">Attributes</div></div>
          <div class="face f3" data-key="Experiences" aria-label="Open Experiences details"><div class="label">Experiences</div></div>
          <div class="face f4" data-key="Habits" aria-label="Open Habits details"><div class="label">Habits</div></div>
          <div class="core" aria-hidden="true"><span>Impact</span></div>
        </div>
      </div>
    </div>

    <div class="hint" id="hint">Drag to rotate. Click a face.</div>

    <div class="overlay" id="overlay" aria-hidden="true">
      <div class="drawer" role="dialog" aria-modal="true" aria-label="Prism details">
        <div class="drawer-head">
          <div>
            <p class="drawer-kicker">The Leadership Prism</p>
            <h3 class="drawer-title" id="drawerTitle">Knowledge</h3>
          </div>
          <button class="close" id="closeBtn" type="button" aria-label="Close">×</button>
        </div>
        <div class="drawer-body" id="drawerBody"></div>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const prism = document.getElementById("prism");
      const dragArea = document.getElementById("dragArea");
      const faces = [...prism.querySelectorAll(".face")];
      const overlay = document.getElementById("overlay");
      const closeBtn = document.getElementById("closeBtn");
      const drawerTitle = document.getElementById("drawerTitle");
      const drawerBody = document.getElementById("drawerBody");
      const hint = document.getElementById("hint");

      const LIB = {"Attributes": {"title": "Attributes", "overview": "Attributes describe how a leader shows up, especially under pressure. They include character, values in action, and interpersonal signals that build trust and credibility.", "taxonomy": [{"name": "Integrity", "definition": "Acts consistently with stated values and ethical standards."}, {"name": "Accountability", "definition": "Owns outcomes and holds self and others responsible."}, {"name": "Courage", "definition": "Willingness to make hard calls and challenge the status quo."}, {"name": "Humility", "definition": "Balances confidence with openness to learn."}, {"name": "Reliability", "definition": "Delivers consistently over time."}, {"name": "Composure", "definition": "Stays steady under pressure."}, {"name": "Clarity", "definition": "Communicates simply and directly."}, {"name": "Stakeholder Awareness", "definition": "Reads people and dynamics."}, {"name": "Judgment", "definition": "Makes sound decisions with incomplete info."}, {"name": "Learning Agility", "definition": "Learns and adapts quickly."}, {"name": "Strategic Orientation", "definition": "Anchors work to long-term value."}, {"name": "Problem Solving", "definition": "Structures complex problems."}], "interventions": ["90-day focus.", "Action learning.", "Bias awareness.", "Coaching", "Coaching labs.", "Coaching."]}, "Habits": {"title": "Habits", "overview": "Habits are the operating system. They are consistent routines and decision hygiene that make performance reliable, sustainable, and scalable.", "taxonomy": [{"name": "Weekly Priorities", "definition": "Sets clear weekly priorities."}, {"name": "Focus Protection", "definition": "Creates deep work time."}, {"name": "De-scoping", "definition": "Removes low-value work."}, {"name": "Follow-through", "definition": "Closes loops reliably."}, {"name": "Clear Delegation", "definition": "Delegates with outcomes."}, {"name": "Decision Closure", "definition": "Finalizes decisions."}, {"name": "Decision Hygiene", "definition": "Uses right inputs."}, {"name": "Meeting Hygiene", "definition": "Runs effective meetings."}, {"name": "Metrics Cadence", "definition": "Reviews metrics regularly."}, {"name": "Stakeholder Cadence", "definition": "Maintains touchpoints."}, {"name": "1:1 Discipline", "definition": "Holds consistent 1:1s."}, {"name": "Conflict Engagement", "definition": "Addresses conflict."}], "interventions": ["90-day focus.", "Cadence map.", "Cadence reset.", "Coaching.", "Contracts.", "Decision reset."]}, "Experiences": {"title": "Experiences", "overview": "Experiences are the load bearing reps that create readiness. They reflect scope, scale, complexity, and the arenas leaders have actually carried responsibility in.", "taxonomy": [{"name": "Enterprise Transformation", "definition": "Led major transformation"}, {"name": "Operating Model Redesign", "definition": "Redesigned operating model"}, {"name": "Org Restructure", "definition": "Restructured teams"}, {"name": "Post-Merger Integration", "definition": "Integrated acquisitions"}, {"name": "Acquisition Diligence", "definition": "Supported diligence"}, {"name": "Turnaround", "definition": "Led recovery"}, {"name": "Crisis Leadership", "definition": "Led crisis response"}, {"name": "Regulatory Event", "definition": "Managed regulatory change"}, {"name": "Board Exposure", "definition": "Presented to board"}, {"name": "Investor Relations", "definition": "Supported investors"}, {"name": "Market Entry", "definition": "Entered new market"}, {"name": "Product Launch", "definition": "Launched product"}], "interventions": ["Coach", "Coaching", "Mentor", "SME", "Sponsor", "Sponsorship"]}, "Skills": {"title": "Skills", "overview": "Skills are observable capabilities used to turn strategy into action. They show up in decisions, outputs, and repeatable performance in real work.", "taxonomy": [{"name": "Strategic planning", "definition": "Ability to apply strategic planning in complex, cross-functional environments to drive enterprise direction and value creation."}, {"name": "Financial statement fluency", "definition": "Ability to apply financial statement fluency using data, stakeholder input, and sound tradeoffs to advance financial and commercial performance."}, {"name": "Operating model design", "definition": "Ability to apply operating model design to improve operating systems and execution at scale."}, {"name": "Org design", "definition": "Ability to apply org design by setting clear decisions, owners, and measures to support leading people and building organizations."}, {"name": "Executive communication", "definition": "Ability to apply executive communication using data, stakeholder input, and sound tradeoffs to advance influence, communication, and stakeholder alignment."}, {"name": "Change leadership", "definition": "Ability to apply change leadership using data, stakeholder input, and sound tradeoffs to advance transformations and sustained change adoption."}, {"name": "Analytics translation", "definition": "Ability to apply analytics translation in complex, cross-functional environments to drive data, technology, and analytics-enabled decisions."}, {"name": "Enterprise risk management", "definition": "Ability to apply enterprise risk management using data, stakeholder input, and sound tradeoffs to advance risk, governance, and compliance oversight."}, {"name": "Customer insight synthesis", "definition": "Ability to apply customer insight synthesis using data, stakeholder input, and sound tradeoffs to advance customer outcomes, products, and growth."}, {"name": "Partner selection", "definition": "Ability to apply partner selection to improve partners, ecosystems, and third-party value."}, {"name": "Enterprise strategy", "definition": "Ability to apply enterprise strategy to improve enterprise direction and value creation."}, {"name": "P&L ownership", "definition": "Ability to apply p&l ownership by setting clear decisions, owners, and measures to support financial and commercial performance."}, {"name": "Operating cadence design", "definition": "Ability to apply operating cadence design using data, stakeholder input, and sound tradeoffs to advance operating systems and execution at scale."}, {"name": "Team building", "definition": "Ability to apply team building in complex, cross-functional environments to drive leading people and building organizations."}], "interventions": ["Practice sessions", "Skill coaching", "Real world project", "Case practice", "Shadowing"]}, "Knowledge": {"title": "Knowledge", "overview": "Knowledge is the domain and enterprise understanding that shapes judgment. It includes business model fluency, market and customer context, and the environments leaders must navigate.", "taxonomy": [{"name": "AI and automation economics", "definition": "Where automation creates value and risk."}, {"name": "Business Models", "definition": "How the business creates value"}, {"name": "Capital markets basics", "definition": "How capital is raised and priced."}, {"name": "Change adoption levers", "definition": "Drivers of behavior change in organizations."}, {"name": "Change Dynamics", "definition": "Leading change"}, {"name": "Compensation and incentives", "definition": "How incentives shape behavior."}, {"name": "Corporate governance", "definition": "How boards and executive governance operate."}, {"name": "Customer Segmentation", "definition": "Understanding customers"}, {"name": "Cybersecurity fundamentals", "definition": "Key cyber risks and controls for leaders."}, {"name": "Data & Measurement", "definition": "Using metrics"}, {"name": "Enterprise architecture concepts", "definition": "How systems fit together at enterprise scale."}, {"name": "ESG and sustainability basics", "definition": "Sustainability concepts that affect enterprise strategy."}, {"name": "Ethics & Reputation", "definition": "Ethical leadership"}, {"name": "Financial Statements", "definition": "Reading P&L/BS/CF"}], "interventions": ["Learning path", "Internal expert sessions", "Customer and field immersion", "Peer learning circle", "Executive synthesis brief"]}};

      const interventionDescriptions = {
        "Coaching": "1:1 support tied to real work goals and visible behavior change.",
        "Executive Coaching": "1:1 support tied to real work goals and visible behavior change.",
        "Skill coaching": "Targeted coaching on one capability, applied immediately in current work.",
        "Practice sessions": "Short, structured reps with feedback to improve a specific capability.",
        "Real world project": "A scoped business problem that forces application and accountability.",
        "Learning path": "Curated learning aligned to the leader’s near term decisions and outcomes.",
        "Internal expert sessions": "Structured time with experts to accelerate context and judgment.",
        "Customer and field immersion": "Direct exposure that sharpens prioritization and decision quality.",
        "Sponsorship": "A senior leader opens doors to the right arenas and provides air cover.",
        "Stretch assignment": "A meaningful scope expansion with clear outcomes and support.",
        "90-day focus": "A quarter-long focus on a small set of behaviors with tracking.",
        "Values-in-action practice": "Scenario practice that builds judgment in high stakes moments.",
        "Stakeholder agreements": "Clear expectations with key partners about signals and success.",
        "Environment design": "Reduce friction and redesign cues to make habits easier to keep.",
        "Peer learning circle": "Structured peer exchange on cases and decisions.",
        "Executive synthesis brief": "Short narrative writing to clarify thinking and sharpen judgment."
      };

      function escapeHtml(s){
        return String(s).replace(/[&<>"']/g, (c) => ({
          "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
        }[c]));
      }

      function renderDrawer(key){
        const data = LIB[key] || LIB.Knowledge;
        drawerTitle.textContent = data.title;

        const items = (data.taxonomy || []).slice(0, 14);
        const pills = items.slice(0, 10).map(x => `<span class="pill">${escapeHtml(x.name)}</span>`).join("");

        const defs = items.slice(0, 4).map(x => `
          <li><b>${escapeHtml(x.name)}</b><br>${escapeHtml(x.definition || "")}</li>
        `).join("");

        const moves = (data.interventions || []).slice(0, 5).map(name => {
          const desc = interventionDescriptions[name] || "A focused development move aligned to the gap.";
          return `<li><b>${escapeHtml(name)}</b><br>${escapeHtml(desc)}</li>`;
        }).join("");

        drawerBody.innerHTML = `
          <div class="section">
            <h4>Overview</h4>
            <p>${escapeHtml(data.overview)}</p>
          </div>

          <div class="section">
            <h4>Sample taxonomy</h4>
            <div class="pillset">${pills}</div>
          </div>

          <div class="section">
            <h4>Selected definitions</h4>
            <ul class="clean">${defs}</ul>
          </div>

          <div class="section">
            <h4>Sample interventions</h4>
            <ul class="clean">${moves}</ul>
          </div>
        `;
      }

      function openDrawer(key){
        renderDrawer(key);
        overlay.classList.add("open");
        overlay.setAttribute("aria-hidden", "false");
        setTimeout(() => closeBtn.focus(), 0);
        hint.classList.add("fade");
      }

      function closeDrawer(){
        overlay.classList.remove("open");
        overlay.setAttribute("aria-hidden", "true");
        prism.focus();
      }

      closeBtn.addEventListener("click", closeDrawer);
      overlay.addEventListener("click", (e) => { if(e.target === overlay) closeDrawer(); });
      window.addEventListener("keydown", (e) => { if(e.key === "Escape") closeDrawer(); });

      // Rotation
      let rotY = 22, rotX = -12;
      let isDown = false;
      let startX = 0, startY = 0;
      let startRotY = rotY, startRotX = rotX;
      let vel = 0, raf = null;

      function apply(){ prism.style.transform = `rotateX(${rotX}deg) rotateY(${rotY}deg)`; }
      function clamp(v, min, max){ return Math.max(min, Math.min(max, v)); }

      const TAP_PX = 8;
      let downClientX = 0, downClientY = 0, downTime = 0;

      function pointerDown(e){
        if(overlay.classList.contains("open")) return;
        isDown = true;
        prism.style.cursor = "grabbing";
        startX = e.clientX; startY = e.clientY;
        startRotY = rotY; startRotX = rotX;
        vel = 0;
        downClientX = e.clientX; downClientY = e.clientY;
        downTime = performance.now();
        if(raf){ cancelAnimationFrame(raf); raf = null; }
        dragArea.setPointerCapture(e.pointerId);

        // Remove the soft nudge after the first interaction
        dragArea.classList.remove("nudge");
        hint.classList.add("fade");
      }

      function pointerMove(e){
        if(!isDown) return;
        const dx = e.clientX - startX;
        const dy = e.clientY - startY;
        rotY = startRotY + dx * 0.35;
        rotX = clamp(startRotX - dy * 0.18, -28, 8);
        vel = dx * 0.02;
        apply();
      }

      function focusFace(key){
        const idx = ["Knowledge","Skills","Attributes","Experiences","Habits"].indexOf(key);
        if(idx < 0) return;
        const target = 22 - (idx * 72);
        const start = rotY;
        const delta = (target - start);
        const duration = 320;
        const t0 = performance.now();
        const ease = (t) => 1 - Math.pow(1 - t, 3);
        const anim = (now) => {
          const t = clamp((now - t0) / duration, 0, 1);
          rotY = start + delta * ease(t);
          apply();
          if(t < 1) requestAnimationFrame(anim);
        };
        requestAnimationFrame(anim);
        faces.forEach(f => f.classList.toggle("active", f.dataset.key === key));
      }

      function openFromPoint(x, y){
        const el = document.elementFromPoint(x, y);
        const face = el && el.closest ? el.closest(".face") : null;
        if(!face) return false;
        const key = face.dataset.key;
        focusFace(key);
        openDrawer(key);
        return true;
      }

      function pointerUp(e){
        if(!isDown) return;
        isDown = false;
        prism.style.cursor = "grab";
        dragArea.releasePointerCapture(e.pointerId);

        const upX = e.clientX, upY = e.clientY;
        const dist = Math.hypot(upX - downClientX, upY - downClientY);
        const elapsed = performance.now() - downTime;

        if(dist <= TAP_PX && elapsed < 700){
          if(openFromPoint(upX, upY)) return;
        }

        const decay = 0.95;
        const step = () => {
          vel *= decay;
          rotY += vel;
          apply();
          if(Math.abs(vel) > 0.02) raf = requestAnimationFrame(step);
          else raf = null;
        };
        if(Math.abs(vel) > 0.05) raf = requestAnimationFrame(step);
      }

      dragArea.addEventListener("pointerdown", pointerDown);
      dragArea.addEventListener("pointermove", pointerMove);
      dragArea.addEventListener("pointerup", pointerUp);
      dragArea.addEventListener("pointercancel", pointerUp);

      // Desktop click fallback
      faces.forEach(face => {
        face.addEventListener("click", (e) => {
          if(overlay.classList.contains("open")) return;
          e.stopPropagation();
          dragArea.classList.remove("nudge");
          const key = face.dataset.key;
          focusFace(key);
          openDrawer(key);
        });
      });

      setTimeout(() => hint.classList.add("fade"), 5200);
      apply();
    })();
  </script>
</body>
</html>
